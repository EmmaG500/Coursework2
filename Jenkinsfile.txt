pipeline{
	agent any
	stages {
		stage('Build') {
			echo "${env.JOB_NAME} build ${env.BUILD_NUMBER} beginning on ${env.JENKINS_URL}"
		}
		stage('Test'){
			echo "Beginning tests..."
			environment {
     				   scannerHome = tool 'SonarQubeScanner'
    			}
    			steps {
        			withSonarQubeEnv('sonarqube') {
            					sh "${scannerHome}/bin/sonar-scanner"
        		}
        		timeout(time: 10, unit: 'MINUTES') {
            					waitForQualityGate abortPipeline: true
        		}
    		}
		stage('Deploy'){
			echo "Deploying on kubernetes and pushing image to DockerHub"
		}
	}
}
